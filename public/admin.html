<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Admin Dashboard</title>
    <link rel="stylesheet" href="style.css" />
  </head>
  <body>
    <header>
      <h1>Admin Dashboard</h1>
      <div id="user-info">
        <span id="username" style="display: none;"></span>
        <button id="logout" class="logout-button" style="display: none;">Logout</button>
      </div>
    </header>
    <nav>
      <ul>
        <li><a href="/">Home</a></li>
        <li><a href="#">About</a></li>
        <li><a href="#">Contact</a></li>
      </ul>
    </nav>
    <main>
      <h2>Welcome, Admin!</h2>
      <div id="admin-actions">
        <h3>Manage Items</h3>
        <form id="add-item-form">
          <label for="item-name">Item Name:</label>
          <input type="text" id="item-name" name="item-name" required />

          <label for="item-category">Category:</label>
          <input type="text" id="item-category" name="item-category" required />
        
          <label for="item-description">Description:</label>
          <textarea id="item-description" name="item-description" required></textarea>
        
          <label for="item-price">Price:</label>
          <input type="number" id="item-price" name="item-price" step="0.01" required />
        
          <label for="item-currency">Currency:</label>
          <input type="text" id="item-currency" name="item-currency" required />
        
          <label for="item-seller">Seller:</label>
          <input type="text" id="item-seller" name="item-seller" required />
        
          <label for="item-image">Image URL:</label>
          <input type="url" id="item-image" name="item-image" required />
        
          <label for="item-size">Size:</label>
          <input type="text" id="item-size" name="item-size" />

          <label for="item-colour">Colour:</label>
          <input type="text" id="item-colour" name="item-colour" />

          <label for="item-spec">Specification:</label>
          <textarea id="item-spec" name="item-spec"></textarea>

        
          
        
          <button type="submit">Add Item</button>
        </form>
        
        <form id="remove-item-form">
          <label for="item-id">Item ID:</label>
          <input type="text" id="item-id" name="item-id" required />
          <button type="submit">Remove Item</button>
        </form>
        <h3>Manage Users</h3>
        <form id="add-user-form">
          <label for="user-username">Username:</label>
          <input type="text" id="user-username" name="user-username" required />
          <label for="user-password">Password:</label>
          <input type="password" id="user-password" name="user-password" required />
          <label for="user-isAdmin">Admin:</label>
          <input type="checkbox" id="user-isAdmin" name="user-isAdmin" />
          <!-- Add any other necessary fields for a user -->
          <button type="submit">Add User</button>
        </form>
        <form id="remove-user-form">
          <label for="user-id">User ID:</label>
          <input type="text" id="user-id" name="user-id" required />
          <button type="submit">Remove User</button>
        </form>
      </div>
    </main>
    <footer>
      <p>&copy; My Online Shop, 2023</p>
    </footer>
    <script>
      // Add necessary JavaScript code here
        const signIn = document.getElementById('sign-in');
        const signUp = document.getElementById('sign-up');
        const logout = document.getElementById('logout');
        const username = document.getElementById('username');

        function updateRequiredFields() {
          const category = document.getElementById("item-category").value.toLowerCase();
          const isClothing = category.includes("Clothing");
          const isComponentOrMonitor = category.includes("Computer Components") || category.includes("Monitors");

          document.getElementById("item-size").required = isClothing;
          document.getElementById("item-colour").required = isClothing;
          document.getElementById("item-spec").required = isComponentOrMonitor;
        }

        const addItemForm = document.getElementById('add-item-form');

        addItemForm.addEventListener('submit', async (event) => {
          event.preventDefault();

          const itemData = {
            name: document.getElementById('item-name').value,
            description: document.getElementById('item-description').value,
            price: document.getElementById('item-price').value,
            currency: document.getElementById('item-currency').value,
            seller: document.getElementById('item-seller').value,
            image: document.getElementById('item-image').value,
            size: document.getElementById('item-size').value,
            colour: document.getElementById('item-colour').value,
            spec: document.getElementById('item-spec').value,
            category: document.getElementById('item-category').value,
          };

          try {
            const response = await fetch('/items', {
              method: 'POST',
              headers: {
                'Content-Type': 'application/json',
                'Authorization': `Bearer ${localStorage.getItem('token')}`,
              },
              body: JSON.stringify(itemData),
            });

            if (response.ok) {
              const result = await response.json();
              alert('Item added successfully.');
              addItemForm.reset();
            } else {
              const error = await response.json();
              alert(`Error: ${error.message || error.error}`);
            }
          } catch (error) {
            alert(`Error: ${error.message}`);
          }
        });

        document.getElementById('add-user-form').addEventListener('submit', async (event) => {
        event.preventDefault();

        const username = document.getElementById('user-username').value;
        const password = document.getElementById('user-password').value;

        try {
          const response = await fetch('/users', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
              'Authorization': `Bearer ${localStorage.getItem('token')}`
            },
            body: JSON.stringify({ username, password })
          });

          if (response.status === 201) {
            const data = await response.json();
            alert(`User created: ${data.user.username}`);
            // Clear input fields after successful submission
            document.getElementById('user-username').value = '';
            document.getElementById('user-password').value = '';
          } else {
            const errorData = await response.json();
            alert(`Error: ${errorData.error}`);
          }
        } catch (error) {
          alert(`Error: ${error.message}`);
        }
      });


        function updateAuthUI() {
        const token = localStorage.getItem('token');
        if (token) {
            const isAdmin = localStorage.getItem('isAdmin') === 'true';
            if (isAdmin) {
            logout.style.display = 'inline';
            username.style.display = 'inline';
            username.textContent = localStorage.getItem('username');
            } else {
            window.location.href = '/';
            }
        } else {
            window.location.href = '/';
        }
        }

        logout.addEventListener('click', () => {
        localStorage.removeItem('token');
        localStorage.removeItem('username');
        localStorage.removeItem('userId');
        localStorage.removeItem('isAdmin');
        updateAuthUI();
        });

        // Update UI on page load
        updateAuthUI();

    </script>
  </body>
</html>
